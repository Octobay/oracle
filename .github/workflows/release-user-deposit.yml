name: Release User Deposit

on:
  issues:
    types: [ opened ]

env:
  username: ${{ github.event.issue.user.login }}
  issueNumber: ${{ github.event.issue.number }}

jobs:
  get-user-address:
    name: Get User Address
    runs-on: ubuntu-latest
    outputs:
      address: ${{ steps.user-address.outputs.address }}
    steps:
      - name: Get Address for ${{ env.username }}
        if: ${{ github.event.issue.title == 'Release User Deposit' }}
        uses: mktcode/get-user-address-action@v1
        id: user-address
        with:
          username: ${{ env.username }}
          access-token: ${{ secrets.GITHUB_TOKEN }}
  
  commenting:
    name: Commenting on Issue
    runs-on: ubuntu-latest
    needs: [ get-user-address ]
    steps:
      - name: Create comment
        uses: peter-evans/create-or-update-comment@v1
        with:
          issue-number: ${{ env.issueNumber }}
          body: Processing your payout request...
  
  release-deposit:
    name: Release Deposit
    runs-on: ubuntu-latest
    needs: [ get-user-address ]
    env:
      address: ${{ needs.get-user-address.outputs.address }}
    steps:
      - name: Release Deposit to ${{ env.address }}
        run: echo "Sending Transaction..."
